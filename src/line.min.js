/*
 * jquery.niceCodeLines
 *
 * @version 0.1.0
 *
 * Copyright (c) 2014 Matouš Němec
 *
 * Licensed under MIT license:
 *      http://www.opensource.org/licenses/mit-license.php
 *
 * Documentation
 *      https://github.com/mesour/jQuery.niceCodeLines#initialization
 */
(function($){$.nice=$.nice||{};$.nice.codeLines={version:'0.1.0',pluginName:$.nice.codeLines&&$.nice.codeLines.pluginName||'niceCodeLines',dataName:'ncl',boxCount:0,options:{wrapperClass:'nice-code-lines',scrollAbout:0,applyHashAfterReady:true,urlHashMatch:function(){}}};$.fn[$.nice.codeLines.pluginName]=function(b){var c=$.extend({},$.nice.codeLines.options,b);this.each(function(){var a=$(this);if(!a.is('pre'))return;if(!a.data($.nice.codeLines.dataName)){if(typeof b==='string')return;a.data($.nice.codeLines.dataName,new r(a,c))}if(b==='findByHash'){a.data($.nice.codeLines.dataName).findByHash()}})};var r=function(d,f){$.nice.codeLines.boxCount++;var g=$.nice.codeLines.boxCount,lines=d.html().split("\n");d.attr('data-box',g);var h=$('<div>');h.addClass('line-numbers');var i='',line=0;$.each(lines,function(n,a){line=(n+1);i+='<span data-id="L'+line+'-'+g+'">'+(!a?'&nbsp;':a)+'</span><br>';h.append('<a id="L'+line+'-'+g+'"><i class="glyphicon glyphicon-link"></i> '+line+'</a>')});var j=$('<div>');j.addClass(f.wrapperClass);var k=$('<code>');k.append(i);d.wrap(j);d.empty().append(k);d.before(h);j=k.closest('.'+f.wrapperClass);var l=0;var m=function(){k.find('.highlighted').removeClass('highlighted')};var o=function(a){if(history.pushState){history.pushState(null,null,'#'+a)}else{location.hash='#'+a}};h.find('a').on('click',function(e){var a=$(this),id=a.attr('id').split('-')[0],num=Number(id.replace('L',''));if(e.shiftKey&&l!==0&&l!==num){var b,to;if(l>num){b=num;to=l}else{b=l;to=num}m();for(var x=b;x<to+1;x++){k.find('[data-id="L'+x+'-'+g+'"]').addClass('highlighted')}o('L'+b+'-'+to+'/'+g)}else{m();k.find('[data-id="L'+num+'-'+g+'"]').addClass('highlighted');o(id+'/'+g);l=num}});var p=function(){var a=$('pre.php').outerHeight()-$('pre.php').height();var b=k.outerHeight()+a;var c=h.outerHeight();while(c<b){k.width(k.width()+10);b=k.outerHeight()+a}};p();$(window).on('resize',p);var q=function(){var a=location.hash.split('/'),hash=a[0];if(!hash.match(/.+-.+/)){$(window).scrollTop($(hash+'-'+g).offset().top+f.scrollAbout);k.find('[data-id="'+(hash.replace('#',''))+'-'+g+'"]').addClass('highlighted')}else{var b=hash.replace('#','').replace('L','').split('-');var c=Number(b[0]),to=Number(b[1]);$(window).scrollTop($('#L'+c+'-'+g).offset().top+f.scrollAbout);for(var x=c;x<to+1;x++){k.find('[data-id="L'+x+'-'+g+'"]').addClass('highlighted')}}};this.findByHash=function(){q()};if(location.hash.match(new RegExp("^#L[0-9]+-?[0-9]*/"+g+"$"))){if(f.applyHashAfterReady){q()}else{f.urlHashMatch.apply(j.get(0),[this])}}}})(jQuery);